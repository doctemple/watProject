var leantime=leantime||{},themeColor=jQuery("meta[name=theme-color]").attr("content");leantime.companyColor=themeColor;var appURL=jQuery("meta[name=identifier-URL]").attr("content");function naturalSort(a,b){var re=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,sre=/(^[ ]*|[ ]*$)/g,dre=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,hre=/^0x[0-9a-f]+$/i,ore=/^0/,x=a.toString().replace(sre,"")||"",y=b.toString().replace(sre,"")||"",xN=x.replace(re,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),yN=y.replace(re,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),xD=parseInt(x.match(hre))||1!=xN.length&&x.match(dre)&&Date.parse(x),yD=parseInt(y.match(hre))||xD&&y.match(dre)&&Date.parse(y)||null;if(yD){if(xD<yD)return-1;if(yD<xD)return 1}for(var cLoc=0,numS=Math.max(xN.length,yN.length);cLoc<numS;cLoc++){if(oFxNcL=!(xN[cLoc]||"").match(ore)&&parseFloat(xN[cLoc])||xN[cLoc]||0,oFyNcL=!(yN[cLoc]||"").match(ore)&&parseFloat(yN[cLoc])||yN[cLoc]||0,isNaN(oFxNcL)!==isNaN(oFyNcL))return isNaN(oFxNcL)?1:-1;if(typeof oFxNcL!=typeof oFyNcL&&(oFxNcL+="",oFyNcL+=""),oFxNcL<oFyNcL)return-1;if(oFxNcL>oFyNcL)return 1}return 0}function removeHTMLTags(string){var strInputCode=string;return(strInputCode=strInputCode.replace(/&(lt|gt);/g,function(strMatch,p1){return"lt"==p1?"<":">"})).replace(/<\/?[^>]+(>|$)/g,"")}function fnCreateSelect(aData){aData.sort(naturalSort);var i,r='<select style="width:100%"><option value=""></option>',iLen=aData.length;for(i=0;i<iLen;i++)r+='<option value="'+aData[i]+'">'+aData[i]+"</option>";return r+"</select>"}leantime.appUrl=appURL,jQuery(document).on("click",function(e){jQuery('[data-toggle="popover"],[data-original-title]').each(function(){jQuery(this).is(e.target)||0!==jQuery(this).has(e.target).length||0!==jQuery(".popover").has(e.target).length||(((jQuery(this).popover("hide").data("bs.popover")||{}).inState||{}).click=!1)})}),leantime.replaceSVGColors=function(){jQuery(document).ready(function(){"#1b75bb"!=leantime.companyColor&&jQuery("svg").children().each(function(){"#1b75bb"==jQuery(this).attr("fill")&&jQuery(this).attr("fill",leantime.companyColor)})})},leantime.replaceSVGColors(),moment.locale(leantime.i18n.__("language.code")),jQuery.noConflict(),jQuery(document).ready(function(){jQuery(".leftmenu .dropdown > a").click(function(){return jQuery(this).next().is(":visible")?jQuery(this).next().slideUp("fast"):jQuery(this).next().slideDown("fast"),!1}),0<jQuery(".widgettitle .close").length&&jQuery(".widgettitle .close").click(function(){jQuery(this).parents(".widgetbox").fadeOut(function(){jQuery(this).remove()})}),jQuery(".userloggedinfo img").click(function(){if(jQuery(window).width()<480){var dm=jQuery(".userloggedinfo .userinfo");dm.is(":visible")?dm.hide():dm.show()}}),jQuery("#dyntable2").dataTable({sPaginationType:"full_numbers",aaSortingFixed:[[0,"asc"]],fnDrawCallback:function(oSettings){}}),jQuery("#dyntable").dataTable({bScrollInfinite:!0,bScrollCollapse:!0,sScrollY:"300px"})}),jQuery(void(jQuery.fn.dataTableExt.oApi.fnGetColumnData=function(oSettings,iColumn,bUnique,bFiltered,bIgnoreEmpty){if(void 0===iColumn)return[];var aiRows;void 0===bUnique&&(bUnique=!0),void 0===bFiltered&&(bFiltered=!0),void 0===bIgnoreEmpty&&(bIgnoreEmpty=!0);for(var asResultData=[],i=0,c=(aiRows=1==bFiltered?oSettings.aiDisplay:oSettings.aiDisplayMaster).length;i<c;i++){iRow=aiRows[i];var sValue=removeHTMLTags(this.fnGetData(iRow)[iColumn]);1==bIgnoreEmpty&&0==sValue.length||1==bUnique&&-1<jQuery.inArray(sValue,asResultData)||asResultData.push(sValue)}return asResultData})),jQuery.fn.dataTableExt.oSort["natural-asc"]=function(a,b){return naturalSort(a,b)},jQuery.fn.dataTableExt.oSort["natural-desc"]=function(a,b){return-1*naturalSort(a,b)};var oTable="",oTable2="";jQuery(document).ready(function($){oTable=$("#resultTable").dataTable({sPaginationType:"full_numbers",bFilter:!0,fnDrawCallback:function(oSettings){},sDom:'<"H"<"left"l><"right"f>>rt<"F"<"left"i><"right"p>>',iDisplayLength:10,aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"Alle"]],oTableTools:{sSwfPath:"includes/libs/DataTables-1.7.6/extras/TableTools/media/swf/copy_cvs_xls_pdf.swf",aButtons:[{sExtends:"copy",sButtonText:"Copy",sButtonClass:"dataTablesCopy",sButtonClassHover:"dataTablesCopyHover"},{sExtends:"print",sButtonText:"Print",sButtonClass:"dataTablesPrint",sButtonClassHover:"dataTablesPrintHover",sInfo:"Dieses ist die Druckansicht. Benutzen Sie nun die Druckfunktion ihres Browsers. Drücken Sie ESC wenn Sie fertig sind."},{sExtends:"collection",sButtonText:"Exportieren",sButtonClass:"dataTablesExport",sButtonClassHover:"dataTablesExportHover",aButtons:["csv","xls","pdf"]}]},oColVis:{buttonText:"Hide Columns"},oLanguage:{sSearch:"Search:",sLengthMenu:"Show _MENU_ entries per page",sZeroRecords:"No results",sInfo:"Show _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Show 0 to 0 of 0 Entries",sInfoFiltered:"(Filtered from _MAX_ entries)"}}),$("#resultTable tfoot tr.filter td:not(.noFilter)").each(function(i){this.innerHTML=fnCreateSelect(oTable.fnGetColumnData(i)),$("select",this).change(function(){oTable.fnFilter($(this).val(),i)})});$("#resultTable2").dataTable({sPaginationType:"full_numbers",bFilter:!0,fnDrawCallback:function(oSettings){},sDom:'<"H"<"left"l><"right"f>>rt<"F"<"left"i><"right"p>>',iDisplayLength:10,aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"Alle"]],oTableTools:{sSwfPath:"includes/libs/DataTables-1.7.6/extras/TableTools/media/swf/copy_cvs_xls_pdf.swf",aButtons:[{sExtends:"copy",sButtonText:"Copy",sButtonClass:"dataTablesCopy",sButtonClassHover:"dataTablesCopyHover"},{sExtends:"print",sButtonText:"Print",sButtonClass:"dataTablesPrint",sButtonClassHover:"dataTablesPrintHover",sInfo:"Dieses ist die Druckansicht. Benutzen Sie nun die Druckfunktion ihres Browsers. Drücken Sie ESC wenn Sie fertig sind."},{sExtends:"collection",sButtonText:"Exportieren",sButtonClass:"dataTablesExport",sButtonClassHover:"dataTablesExportHover",aButtons:["csv","xls","pdf"]}]},oColVis:{buttonText:"Hide Columns"},oLanguage:{sSearch:"Search:",sLengthMenu:"Show _MENU_ entries per page",sZeroRecords:"No results",sInfo:"Show _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Show 0 to 0 of 0 Entries",sInfoFiltered:"(Filtered from _MAX_ entries)"}});$("#resultTable tfoot tr.filter td:not(.noFilter)").each(function(i){this.innerHTML=fnCreateSelect(oTable.fnGetColumnData(i)),$("select",this).change(function(){oTable.fnFilter($(this).val(),i)})});$("#resultTable3").dataTable({sPaginationType:"full_numbers",bFilter:!0,fnDrawCallback:function(oSettings){},sDom:'<"H"<"left"l><"right"f>>rt<"F"<"left"i><"right"p>>',iDisplayLength:10,aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"Alle"]],oTableTools:{sSwfPath:"includes/libs/DataTables-1.7.6/extras/TableTools/media/swf/copy_cvs_xls_pdf.swf",aButtons:[{sExtends:"copy",sButtonText:"Copy",sButtonClass:"dataTablesCopy",sButtonClassHover:"dataTablesCopyHover"},{sExtends:"print",sButtonText:"Print",sButtonClass:"dataTablesPrint",sButtonClassHover:"dataTablesPrintHover",sInfo:"Dieses ist die Druckansicht. Benutzen Sie nun die Druckfunktion ihres Browsers. Drücken Sie ESC wenn Sie fertig sind."},{sExtends:"collection",sButtonText:"Exportieren",sButtonClass:"dataTablesExport",sButtonClassHover:"dataTablesExportHover",aButtons:["csv","xls","pdf"]}]},oColVis:{buttonText:"Hide Columns"},oLanguage:{sSearch:"Search:",sLengthMenu:"Show _MENU_ entries per page",sZeroRecords:"No results",sInfo:"Show _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Show 0 to 0 of 0 Entries",sInfoFiltered:"(Filtered from _MAX_ entries)"}});$("#resultTable tfoot tr.filter td:not(.noFilter)").each(function(i){this.innerHTML=fnCreateSelect(oTable.fnGetColumnData(i)),$("select",this).change(function(){oTable.fnFilter($(this).val(),i)})})}),leantime.calendarController=function(){jQuery(document).ready(function(){});return{initCalendar:function(userEvents){var date=new Date,heightWindow=(date.getDate(),date.getMonth(),date.getFullYear(),jQuery(".mainwrapper").height()),calendar=jQuery("#calendar").fullCalendar({height:heightWindow,header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay,listDay"},titleFormat:{month:"MMMM yyyy",week:"MMM d[ yyyy]{ '&#8212;'[ MMM] d yyyy}",day:"dddd, MMM d, yyyy"},columnFormat:{month:leantime.i18n.__("language.columnFormatMonth"),week:leantime.i18n.__("language.columnFormatWeek"),day:leantime.i18n.__("language.columnFormatday")},timeFormat:{"":leantime.i18n.__("language.jstimeformat")},isRTL:"false"==leantime.i18n.__("language.isRTL")?0:1,firstDay:leantime.i18n.__("language.firstDayOfWeek"),monthNames:leantime.i18n.__("language.monthNames").split(","),monthNamesShort:leantime.i18n.__("language.monthNamesShort").split(","),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),buttonText:{prev:"&laquo;",next:"&raquo;",prevYear:"&nbsp;&lt;&lt;&nbsp;",nextYear:"&nbsp;&gt;&gt;&nbsp;",today:leantime.i18n.__("buttons.today"),month:leantime.i18n.__("buttons.month"),week:leantime.i18n.__("buttons.week"),day:leantime.i18n.__("buttons.day")},select:function(start,end,allDay){var title=prompt(leantime.i18n.__("label.event_title"));title&&calendar.fullCalendar("renderEvent",{title:title,start:start,end:end,allDay:allDay},!0),calendar.fullCalendar("unselect")},events:userEvents,eventColor:"#0866c6"})},initEventDatepickers:function(){Date.prototype.addDays=function(days){return this.setDate(this.getDate()+days),this},jQuery.datepicker.setDefaults({beforeShow:function(i){if(jQuery(i).attr("readonly"))return!1}});var dateFormat=leantime.i18n.__("language.jsdateformat"),from=jQuery("#event_date_from").datepicker({numberOfMonths:1,dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:leantime.i18n.__("language.isRTL"),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")}).on("change",function(){to.datepicker("option","minDate",getDate(this))}),to=jQuery("#event_date_to").datepicker({numberOfMonths:1,dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:leantime.i18n.__("language.isRTL"),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")}).on("change",function(){from.datepicker("option","maxDate",getDate(this))});function getDate(element){var date;try{date=jQuery.datepicker.parseDate(dateFormat,element.value)}catch(error){date=null,console.log(error)}return date}jQuery("#event_time_from").timepicker({showMeridian:"false"!=leantime.i18n.__("language.isMeridian")}),jQuery("#event_time_to").timepicker({showMeridian:"false"!=leantime.i18n.__("language.isMeridian")})}}}(),leantime.clientsController=function(){jQuery(document).ready(function(){});return{initDates:function(){jQuery(".projectDateFrom, .projectDateTo").datepicker({dateFormat:leantime.i18n.__("language.dateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:JSON.parse(leantime.i18n.__("language.isRTL")),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")})},initClientTabs:function(){jQuery(".clientTabs").tabs()},initClientTable:function(){jQuery(document).ready(function(){jQuery("#allClientsTable").DataTable({language:{decimal:leantime.i18n.__("datatables.decimal"),emptyTable:leantime.i18n.__("datatables.emptyTable"),info:leantime.i18n.__("datatables.info"),infoEmpty:leantime.i18n.__("datatables.infoEmpty"),infoFiltered:leantime.i18n.__("datatables.infoFiltered"),infoPostFix:leantime.i18n.__("datatables.infoPostFix"),thousands:leantime.i18n.__("datatables.thousands"),lengthMenu:leantime.i18n.__("datatables.lengthMenu"),loadingRecords:leantime.i18n.__("datatables.loadingRecords"),processing:leantime.i18n.__("datatables.processing"),search:leantime.i18n.__("datatables.search"),zeroRecords:leantime.i18n.__("datatables.zeroRecords"),paginate:{first:leantime.i18n.__("datatables.first"),last:leantime.i18n.__("datatables.last"),next:leantime.i18n.__("datatables.next"),previous:leantime.i18n.__("datatables.previous")},aria:{sortAscending:leantime.i18n.__("datatables.sortAscending"),sortDescending:leantime.i18n.__("datatables.sortDescending")}},dom:'<"top">rt<"bottom"ilp><"clear">',searching:!1,displayLength:100})})}}}(),leantime.dashboardController=function(){jQuery(document).ready(function(){_initDueDateTimePickers()});var _initDueDateTimePickers=function(){jQuery(".duedates").datepicker({dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:JSON.parse(leantime.i18n.__("language.isRTL")),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader"),onClose:function(date){var newDate;""==date&&jQuery(this).val(leantime.i18n.__("text.anytime"));var dateTime=moment(date,leantime.i18n.__("language.momentJSDate")).format("YYYY-MM-DD HH:mm:ss"),id=jQuery(this).attr("data-id");newDate=dateTime,leantime.ticketsRepository.updateDueDates(id,newDate,function(){jQuery.jGrowl(leantime.i18n.__("short_notifications.duedate_updated"))})}})};return{chartColors:{red:"rgb(201,48,44)",orange:"rgb(255, 159, 64)",yellow:"rgb(255, 205, 86)",green:"rgb(90,182,90)",blue:"rgb(54, 162, 235)",purple:"rgb(153, 102, 255)",grey:"rgb(201, 203, 207)"},initBurndown:function(labels,plannedData,actualData){moment.locale(leantime.i18n.__("language.code"));var config={type:"line",data:{labels:labels,datasets:[{label:leantime.i18n.__("label.ideal"),backgroundColor:leantime.dashboardController.chartColors.blue,borderColor:leantime.dashboardController.chartColors.blue,data:plannedData,fill:!1,lineTension:0},{label:"Actual",backgroundColor:leantime.dashboardController.chartColors.red,borderColor:leantime.dashboardController.chartColors.red,data:actualData,fill:!1,lineTension:0}]},options:{responsive:!0,maintainAspectRatio:!1,title:{display:!1,text:"Line Chart"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},legend:{position:"bottom"},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:leantime.i18n.__("label.date")},type:"time",time:{unit:"day"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:leantime.i18n.__("label.effort")},ticks:{beginAtZero:!0}}]}}},ctx2=document.getElementById("sprintBurndown").getContext("2d");return _burndownChart=new Chart(ctx2,config),_burndownChart},initChartButtonClick:function(id,plannedData,actualData,chart){jQuery("#"+id).click(function(event){chart.data.datasets[0].data=plannedData,chart.data.datasets[1].data=actualData,chart.options.scales.yAxes[0].scaleLabel.labelString=leantime.i18n.__("label.open_todos"),jQuery(".chartButtons").removeClass("active"),jQuery(this).addClass("active"),chart.update()})},initBacklogBurndown:function(labels,actualData){moment.locale(leantime.i18n.__("language.code"));var config={type:"line",data:{labels:labels,datasets:[{label:leantime.i18n.__("label.done_todos"),backgroundColor:leantime.dashboardController.chartColors.green,borderColor:leantime.dashboardController.chartColors.green,data:actualData.done.data,fill:!0,lineTension:0,pointRadius:0},{label:leantime.i18n.__("label.progress_todos"),backgroundColor:leantime.dashboardController.chartColors.yellow,borderColor:leantime.dashboardController.chartColors.yellow,data:actualData.progress.data,fill:!0,lineTension:0,pointRadius:0},{label:leantime.i18n.__("label.new_todos"),backgroundColor:leantime.dashboardController.chartColors.red,borderColor:leantime.dashboardController.chartColors.red,data:actualData.open.data,fill:!0,lineTension:0,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,title:{display:!1,text:"Line Chart"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},legend:{position:"bottom"},elements:{point:{pointStyle:"line",radius:"0"}},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:leantime.i18n.__("label.date")},type:"time"}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:leantime.i18n.__("label.num_tickets")},ticks:{beginAtZero:!0},stacked:!0}]}}},ctx2=document.getElementById("backlogBurndown").getContext("2d");return _burndownChart=new Chart(ctx2,config),_burndownChart},initBacklogChartButtonClick:function(id,actualData,label,chart){jQuery("#"+id).click(function(event){chart.data.datasets[0].data=actualData.done.data,chart.data.datasets[1].data=actualData.progress.data,chart.data.datasets[2].data=actualData.open.data,chart.options.scales.yAxes[0].scaleLabel.labelString=label,jQuery(".backlogChartButtons").removeClass("active"),jQuery(this).addClass("active"),chart.update()})},initProgressChart:function(chartId,complete,incomplete){var config={type:"doughnut",data:{datasets:[{data:[complete,incomplete],backgroundColor:[leantime.dashboardController.chartColors.green,leantime.dashboardController.chartColors.grey],label:leantime.i18n.__("label.project_done")}],labels:[complete+"% Done",incomplete+"% Open"]},options:{maintainAspectRatio:!1,responsive:!0,legend:{position:"bottom"},title:{display:!1,text:""},animation:{animateScale:!0,animateRotate:!0}}},ctx=document.getElementById(chartId).getContext("2d");new Chart(ctx,config)},prepareHiddenDueDate:function(){var thisFriday=moment().startOf("week").add(5,"days");jQuery("#dateToFinish").val(thisFriday.format("YYYY-MM-DD"))}}}(),leantime.generalController=function(){jQuery(document).ready(function(){_initPopOvers(),_initLabelModals()});var _initPopOvers=function(){jQuery(".popoverlink").popover({trigger:"hover"})},_initLabelModals=function(){var editLabelModalConfig={sizes:{minW:400,minH:200},callbacks:{afterShowCont:function(){jQuery(".editLabelModal").nyroModal(editLabelModalConfig)},beforeClose:function(){location.reload()}}};jQuery(".editLabelModal").nyroModal(editLabelModalConfig)};return{}}(),leantime.menuController=function(){jQuery(document).ready(function(){_initProjectSelector(),_initLeftMenuHamburgerButton(),_initProjectSelectorToggle()});var _initProjectSelector=function(){jQuery(".project-select").chosen()},_initLeftMenuHamburgerButton=function(){jQuery(".barmenu").hasClass("open")?(jQuery(".rightpanel, .headerinner").css({marginLeft:"260px"}),jQuery(".logo, .leftpanel").css({marginLeft:0}),leantime.menuRepository.updateUserMenuSettings("open")):(jQuery(".rightpanel, .headerinner").css({marginLeft:0}),jQuery(".logo, .leftpanel").css({marginLeft:"-260px"}),leantime.menuRepository.updateUserMenuSettings("closed")),jQuery(".barmenu").click(function(){jQuery(window).width(),jQuery(this).hasClass("open")?(jQuery(".rightpanel, .headerinner").animate({marginLeft:0},"fast",function(){jQuery(".barmenu").removeClass("open")}),jQuery(".logo, .leftpanel").animate({marginLeft:"-260px"},"fast"),leantime.menuRepository.updateUserMenuSettings("closed")):(jQuery(".rightpanel, .headerinner").animate({marginLeft:"260px"},"fast",function(){jQuery(".barmenu").addClass("open")}),jQuery(".logo, .leftpanel").animate({marginLeft:0},"fast"),leantime.menuRepository.updateUserMenuSettings("open"))}),jQuery(window).resize(function(){jQuery(".barmenu").hasClass("open")?(jQuery(".rightpanel, .headerinner").css({marginLeft:"260px"}),jQuery(".logo, .leftpanel").css({marginLeft:0}),leantime.menuRepository.updateUserMenuSettings("open")):(jQuery(".rightpanel, .headerinner").css({marginLeft:0}),jQuery(".logo, .leftpanel").css({marginLeft:"-260px"}),leantime.menuRepository.updateUserMenuSettings("closed"))})},_initProjectSelectorToggle=function(id,element){jQuery(document).on("click",".project-selector .dropdown-menu",function(e){e.stopPropagation()})};return{toggleClientList:function(id,element){jQuery(".client_"+id).toggle("fast"),jQuery(element).find("i").hasClass("fa-caret-down")?(jQuery(element).find("i").removeClass("fa-caret-down"),jQuery(element).find("i").addClass("fa-caret-up")):(jQuery(element).find("i").removeClass("fa-caret-up"),jQuery(element).find("i").addClass("fa-caret-down"))}}}(),(leantime=leantime||{}).menuRepository={updateUserMenuSettings:function(menuStateValue){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/sessions",data:{menuState:menuStateValue}}).done(function(){})}},leantime.helperController=function(){jQuery(document).ready(function(){});return{showHelperModal:function(module,minW,minH){jQuery.nmManual(leantime.appUrl+"/help/showOnboardingDialog?module="+module,{sizes:{minW:minW||200,minH:minH||500},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){leantime.replaceSVGColors()}}})},hideAndKeepHidden:function(module){leantime.helperRepository.updateUserModalSettings(module),jQuery.nmTop().close()},startDashboardTour:function(){leantime.helperRepository.startingTour(),jQuery.nmTop().close();var tour=new Shepherd.Tour({defaults:{classes:"shepherd-theme-arrows",showCancelLink:!0,scrollTo:!0}});tour.addStep("Left Nav",{title:leantime.i18n.__("tour.left_navigation"),text:leantime.i18n.__("tour.left_nav_text"),attachTo:".leftmenu ul right",advanceOn:".headmenu click",buttons:[{text:leantime.i18n.__("tour.cancel"),classes:"shepherd-button-secondary",action:tour.cancel},{text:leantime.i18n.__("tour.next"),action:tour.next}]}),tour.addStep("Project Selection",{title:leantime.i18n.__("tour.project_selection"),text:leantime.i18n.__("tour.project_selection_text"),attachTo:".project-selector right",buttons:[{text:leantime.i18n.__("tour.back"),classes:"shepherd-button-secondary",action:tour.back},{text:leantime.i18n.__("tour.next"),action:tour.next}]}),tour.addStep("Header Navigation",{title:leantime.i18n.__("tour.top_navigation"),text:leantime.i18n.__("tour.top_navigation_text"),attachTo:".headmenu bottom",advanceOn:"#sprintBurndownChart click",buttons:[{text:leantime.i18n.__("tour.back"),classes:"shepherd-button-secondary",action:tour.back},{text:leantime.i18n.__("tour.next"),action:tour.next}]}),tour.addStep("Project Status",{title:leantime.i18n.__("tour.project_progress"),text:leantime.i18n.__("tour.project_progress_text"),attachTo:"#projectProgressContainer left",advanceOn:".headmenu click",buttons:[{text:leantime.i18n.__("tour.back"),classes:"shepherd-button-secondary",action:tour.back},{text:leantime.i18n.__("tour.next"),action:tour.next}]}),tour.addStep("Your Todos",{title:leantime.i18n.__("tour.milestone_progress"),text:leantime.i18n.__("tour.milestone_progress_text"),attachTo:"#milestoneProgressContainer left",advanceOn:".headmenu click",buttons:[{text:leantime.i18n.__("tour.back"),classes:"shepherd-button-secondary",action:tour.back},{text:leantime.i18n.__("tour.next"),action:tour.next}]}),tour.addStep("Your Todos",{title:leantime.i18n.__("tour.your_todos"),text:leantime.i18n.__("tour.your_todos_text"),attachTo:"#yourToDoContainer top",advanceOn:".headmenu click",buttons:[{text:leantime.i18n.__("tour.back"),classes:"shepherd-button-secondary",action:tour.back},{text:leantime.i18n.__("tour.next"),action:tour.next}]}),tour.addStep("Your Todos",{title:leantime.i18n.__("tour.congratulations"),text:leantime.i18n.__("tour.congratulations_dashboard_text"),buttons:[{text:leantime.i18n.__("tour.close"),action:tour.cancel}],advanceOn:".headmenu click"}),tour.start()},startKanbanTour:function(){jQuery.nmTop().close();var tour=new Shepherd.Tour({defaults:{classes:"shepherd-theme-arrows",showCancelLink:!0,scrollTo:!0}});tour.addStep("Left Nav",{title:leantime.i18n.__("tour.kanban"),text:leantime.i18n.__("tour.kanban_text"),attachTo:".column right",advanceOn:".headmenu click",buttons:[{text:"Cancel",classes:"shepherd-button-secondary",action:tour.cancel},{text:"Next",action:tour.next}]}),tour.addStep("Left Nav",{title:leantime.i18n.__("tour.drag_drop"),text:leantime.i18n.__("tour.drag_drop_text"),attachTo:".ticketBox h4 right",advanceOn:".ticketBox click",buttons:[{text:leantime.i18n.__("tour.back"),classes:"shepherd-button-secondary",action:tour.back},{text:leantime.i18n.__("tour.next"),action:tour.next}]}),tour.addStep("Change Views",{title:leantime.i18n.__("tour.change_views"),text:leantime.i18n.__("tour.change_views_text"),attachTo:".btn-group .fa-columns left",advanceOn:".ticketBox click",buttons:[{text:leantime.i18n.__("tour.back"),classes:"shepherd-button-secondary",action:tour.back},{text:leantime.i18n.__("tour.next"),action:tour.next}]}),tour.addStep("Your Todos",{title:leantime.i18n.__("tour.congratulations"),text:leantime.i18n.__("tour.congratulations_kanban_text"),buttons:[{text:leantime.i18n.__("tour.close"),action:tour.complete}],advanceOn:".headmenu click"}),tour.on("complete",function(){leantime.helperRepository.stopTour()}),tour.start()}}}(),(leantime=leantime||{}).helperRepository={updateUserModalSettings:function(module){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/users",data:{settings:module,patchModalSettings:1}}).done(function(){})},startingTour:function(){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/sessions",data:{tourActive:1}}).done(function(){})},stopTour:function(){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/sessions",data:{tourActive:0}}).done(function(){})}},leantime.ideasController=function(){var closeModal=!1,canvasoptions={sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){jQuery(".showDialogOnLoad").show(),1==closeModal&&(closeModal=!1,location.reload())},afterShowCont:function(){jQuery(".ideaModal, #commentForm, #commentForm .deleteComment, .leanCanvasMilestone .deleteMilestone").nyroModal(canvasoptions),jQuery("textarea.ideaTextEditor").tinymce({width:"100%",height:"400px",skin_url:leantime.appUrl+"/css/tinymceSkin/oxide",content_css:leantime.appUrl+"/css/tinymceSkin/oxide/content.css",content_style:"img { max-width: 100%; }",plugins:"autolink,link,textcolor,image,lists,pagebreak,table,save,insertdatetime,preview,media,searchreplace,print,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,template,advlist",toolbar:"bold italic strikethrough | fontsizeselect forecolor | link unlink image | bullist | fullscreen",branding:!1,statusbar:!1,convert_urls:!1,paste_data_images:!0,images_upload_handler:function(blobInfo,success,failure){var xhr,formData;(xhr=new XMLHttpRequest).withCredentials=!1,xhr.open("POST",leantime.appUrl+"/api/files"),xhr.onload=function(){xhr.status<200||300<=xhr.status?failure("HTTP Error: "+xhr.status):success(xhr.responseText)},(formData=new FormData).append("file",blobInfo.blob()),xhr.send(formData)},file_picker_callback:function(callback,value,meta){window.filePickerCallback=callback;var shortOptions={afterShowCont:function(){jQuery(".fileModal").nyroModal({callbacks:shortOptions})}};jQuery.nmManual(leantime.appUrl+"/files/showAll&modalPopUp=true",{stack:!0,callbacks:shortOptions,sizes:{minW:500,minH:500}}),jQuery.nmTop().elts.cont.css("zIndex","1000010"),jQuery.nmTop().elts.bg.css("zIndex","1000010"),jQuery.nmTop().elts.load.css("zIndex","1000010"),jQuery.nmTop().elts.all.find(".nyroModalCloseButton").css("zIndex","1000010")}})},beforeClose:function(){location.reload()}},titleFromIframe:!0};jQuery(document).ready(function(){_initModals()});var _initModals=function(){jQuery(".ideaModal, #commentForm, #commentForm .deleteComment, .leanCanvasMilestone .deleteMilestone").nyroModal(canvasoptions)};return{setCloseModal:function(){closeModal=!0},toggleMilestoneSelectors:function(trigger){"existing"==trigger&&(jQuery("#newMilestone, #milestoneSelectors").hide("fast"),jQuery("#existingMilestone").show(),_initModals()),"new"==trigger&&(jQuery("#newMilestone").show(),jQuery("#existingMilestone, #milestoneSelectors").hide("fast"),_initModals()),"hide"==trigger&&(jQuery("#newMilestone, #existingMilestone").hide("fast"),jQuery("#milestoneSelectors").show("fast"))},openModalManually:function(url){jQuery.nmManual(url,canvasoptions)},initMasonryWall:function(){var $grid=jQuery("#ideaMason").packery({itemSelector:".ticketBox",columnWidth:260,isResizable:!0});$grid.imagesLoaded().progress(function(){$grid.packery("layout")});var $items=$grid.find(".ticketBox").draggable({start:function(event,ui){ui.helper.addClass("tilt"),function(item){function move_handler(e){e.pageX>=left_pos?(item.addClass("right"),item.removeClass("left")):(item.addClass("left"),item.removeClass("right")),left_pos=e.pageX}var left_pos=item.position().left;jQuery("html").bind("mousemove",move_handler),item.data("move_handler",move_handler)}(ui.helper)},stop:function(event,ui){ui.helper.removeClass("tilt"),jQuery("html").unbind("mousemove",ui.helper.data("move_handler")),ui.helper.removeData("move_handler")}});$grid.packery("bindUIDraggableEvents",$items),$grid.on("dragItemPositioned",function(){var ideaSort=[],itemElems=$grid.packery("getItemElements");jQuery(itemElems).each(function(i,itemElem){var sortIndex=i+1,ideaId=jQuery(itemElem).attr("data-value");ideaSort.push({id:ideaId,sortIndex:sortIndex})}),jQuery.ajax({type:"POST",url:leantime.appUrl+"/api/ideas",data:{action:"ideaSort",payload:ideaSort}})})},initBoardControlModal:function(){jQuery(".addItem").click(function(){jQuery("#box").val(jQuery(this).attr("id")),jQuery("#addItem").modal("show")}),jQuery(".addCanvasLink").click(function(){jQuery("#addCanvas").modal("show")}),jQuery(".editCanvasLink").click(function(){jQuery("#editCanvas").modal("show")})},initWallImageModals:function(){jQuery(".mainIdeaContent img").each(function(){jQuery(this).wrap("<a href='"+jQuery(this).attr("src")+"' class='imageModal'></a>")}),jQuery(".imageModal").nyroModal()},initUserDropdown:function(){jQuery("body").on("click",".userDropdown .dropdown-menu a",function(){var dataValue=jQuery(this).attr("data-value").split("_");jQuery(this).attr("data-label");if(3==dataValue.length){var canvasId=dataValue[0],userId=dataValue[1],profileImageId=dataValue[2];jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/ideas",data:{id:canvasId,author:userId}}).done(function(){jQuery("#userDropdownMenuLink"+canvasId+" span.text span#userImage"+canvasId+" img").attr("src",leantime.appUrl+"/api/users?profileImage="+profileImageId),jQuery.jGrowl(leantime.i18n.__("short_notifications.user_updated"))})}})},initStatusDropdown:function(){jQuery("body").on("click",".statusDropdown .dropdown-menu a",function(){var dataValue=jQuery(this).attr("data-value").split("_"),dataLabel=jQuery(this).attr("data-label");if(3==dataValue.length){var canvasItemId=dataValue[0],status=dataValue[1],statusClass=dataValue[2];jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/ideas",data:{id:canvasItemId,box:status}}).done(function(){jQuery("#statusDropdownMenuLink"+canvasItemId+" span.text").text(dataLabel),jQuery("#statusDropdownMenuLink"+canvasItemId).removeClass().addClass(statusClass+" dropdown-toggle f-left status "),jQuery.jGrowl(leantime.i18n.__("short_notifications.status_updated"))})}})},setKanbanHeights:function(){var height=jQuery("html").height()-320;jQuery("#sortableIdeaKanban .column .contentInner").css("height",height)},initIdeaKanban:function(statusList){jQuery("#sortableIdeaKanban").disableSelection(),jQuery(".ticketBox").hover(function(){jQuery(this).css("background","#f9f9f9")},function(){jQuery(this).css("background","#ffffff")}),jQuery("#sortableIdeaKanban .contentInner").sortable({connectWith:".contentInner",items:"> .moveable",tolerance:"pointer",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,cancel:".portlet-toggle",start:function(event,ui){ui.item.addClass("tilt"),function(item){function move_handler(e){e.pageX>=left_pos?(item.addClass("right"),item.removeClass("left")):(item.addClass("left"),item.removeClass("right")),left_pos=e.pageX}var left_pos=item.position().left;jQuery("html").bind("mousemove",move_handler),item.data("move_handler",move_handler)}(ui.item)},stop:function(event,ui){ui.item.removeClass("tilt"),jQuery("html").unbind("mousemove",ui.item.data("move_handler")),ui.item.removeData("move_handler")},update:function(event,ui){for(var statusPostData={action:"statusUpdate",payload:{}},i=0;i<statusList.length;i++)jQuery(".contentInner.status_"+statusList[i]).length&&(statusPostData.payload[statusList[i]]=jQuery(".contentInner.status_"+statusList[i]).sortable("serialize"));jQuery.ajax({type:"POST",url:leantime.appUrl+"/api/ideas",data:statusPostData})}}),jQuery(".portlet").addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all").find(".portlet-header").addClass("ui-widget-header ui-corner-all").prepend("<span class='ui-icon ui-icon-minusthick portlet-toggle'></span>"),jQuery(".portlet-toggle").click(function(){var icon=jQuery(this);icon.toggleClass("ui-icon-minusthick ui-icon-plusthick"),icon.closest(".portlet").find(".portlet-content").toggle()})}}}(),leantime.leanCanvasController=function(){var closeModal=!1,canvasoptions={sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){jQuery(".showDialogOnLoad").show(),1==closeModal&&(closeModal=!1,location.reload())},afterShowCont:function(){jQuery(".canvasModal, #commentForm, #commentForm .deleteComment, .leanCanvasMilestone .deleteMilestone").nyroModal(canvasoptions),jQuery("textarea.researchTextEditor").tinymce({width:"100%",height:"200px",skin_url:leantime.appUrl+"/css/tinymceSkin/oxide",content_css:leantime.appUrl+"/css/tinymceSkin/oxide/content.css",content_style:"img { max-width: 100%; }",plugins:"autolink,link,textcolor,image,lists,pagebreak,table,save,insertdatetime,preview,media,searchreplace,print,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,template,advlist",toolbar:"bold italic strikethrough | fontsizeselect forecolor | link unlink image | bullist | fullscreen",branding:!1,statusbar:!1,convert_urls:!1,paste_data_images:!0,images_upload_handler:function(blobInfo,success,failure){var xhr,formData;(xhr=new XMLHttpRequest).withCredentials=!1,xhr.open("POST",leantime.appUrl+"/api/files"),xhr.onload=function(){xhr.status<200||300<=xhr.status?failure("HTTP Error: "+xhr.status):success(xhr.responseText)},(formData=new FormData).append("file",blobInfo.blob()),xhr.send(formData)},file_picker_callback:function(callback,value,meta){window.filePickerCallback=callback;var shortOptions={afterShowCont:function(){jQuery(".fileModal").nyroModal({callbacks:shortOptions})}};jQuery.nmManual(leantime.appUrl+"/files/showAll&modalPopUp=true",{stack:!0,callbacks:shortOptions,sizes:{minW:500,minH:500}}),jQuery.nmTop().elts.cont.css("zIndex","1000010"),jQuery.nmTop().elts.bg.css("zIndex","1000010"),jQuery.nmTop().elts.load.css("zIndex","1000010"),jQuery.nmTop().elts.all.find(".nyroModalCloseButton").css("zIndex","1000010")}})},beforeClose:function(){location.reload()}},titleFromIframe:!0};jQuery(document).ready(function(){_initModals()});var _initModals=function(){jQuery(".canvasModal, #commentForm, #commentForm .deleteComment, .leanCanvasMilestone .deleteMilestone").nyroModal(canvasoptions)};return{setCloseModal:function(){closeModal=!0},toggleMilestoneSelectors:function(trigger){"existing"==trigger&&(jQuery("#newMilestone, #milestoneSelectors").hide("fast"),jQuery("#existingMilestone").show(),_initModals()),"new"==trigger&&(jQuery("#newMilestone").show(),jQuery("#existingMilestone, #milestoneSelectors").hide("fast"),_initModals()),"hide"==trigger&&(jQuery("#newMilestone, #existingMilestone").hide("fast"),jQuery("#milestoneSelectors").show("fast"))},openModalManually:function(url){jQuery.nmManual(url,canvasoptions)},setCanvasHeights:function(){var maxHeight=0;jQuery("#firstRow div.contentInner").each(function(){jQuery(this).height()>maxHeight&&(maxHeight=jQuery(this).height()+100)}),jQuery("#firstRow div.contentInner").css("height",maxHeight)},initFilterBar:function(){jQuery(window).bind("load",function(){jQuery(".loading").fadeOut(),jQuery(".filterBar .row-fluid").css("opacity","1")})},initCanvasLinks:function(){jQuery(".addCanvasLink").click(function(){jQuery("#addCanvas").modal("show")}),jQuery(".editCanvasLink").click(function(){jQuery("#editCanvas").modal("show")})},initUserDropdown:function(){jQuery("body").on("click",".userDropdown .dropdown-menu a",function(){var dataValue=jQuery(this).attr("data-value").split("_"),dataLabel=jQuery(this).attr("data-label");if(3==dataValue.length){var canvasId=dataValue[0],userId=dataValue[1],profileImageId=dataValue[2];jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/leancanvas",data:{id:canvasId,author:userId}}).done(function(){jQuery("#userDropdownMenuLink"+canvasId+" span.text span#userImage"+canvasId+" img").attr("src",leantime.appUrl+"/api/users?profileImage="+profileImageId),jQuery("#userDropdownMenuLink"+canvasId+" span.text span#user"+canvasId).text(dataLabel),jQuery.jGrowl(leantime.i18n.__("short_notifications.user_updated"))})}})},initStatusDropdown:function(){jQuery("body").on("click",".statusDropdown .dropdown-menu a",function(){var dataValue=jQuery(this).attr("data-value").split("_"),dataLabel=jQuery(this).attr("data-label");if(2==dataValue.length){var canvasItemId=dataValue[0],status=dataValue[1];jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/leancanvas",data:{id:canvasItemId,status:status}}).done(function(){jQuery("#statusDropdownMenuLink"+canvasItemId+" span.text").text(dataLabel),jQuery("#statusDropdownMenuLink"+canvasItemId).removeClass().addClass("label-"+status+" dropdown-toggle f-left status "),jQuery.jGrowl(leantime.i18n.__("short_notifications.status_updated"))})}})},setSimpleCanvasHeights:function(){var height=jQuery("html").height()-320;jQuery("#firstRow .column .contentInner").css("height",height)}}}(),leantime.projectsController=function(){jQuery(document).ready(function(){});function initDates(){jQuery(".projectDateFrom, .projectDateTo").datepicker({dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:JSON.parse(leantime.i18n.__("language.isRTL")),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")})}return{initDates:initDates,initProjectTabs:function(){jQuery(".projectTabs").tabs()},initProgressBar:function(percentage){jQuery("#progressbar").progressbar({value:percentage})},initProjectTable:function(){jQuery(document).ready(function(){jQuery("#allProjectsTable").DataTable({language:{decimal:leantime.i18n.__("datatables.decimal"),emptyTable:leantime.i18n.__("datatables.emptyTable"),info:leantime.i18n.__("datatables.info"),infoEmpty:leantime.i18n.__("datatables.infoEmpty"),infoFiltered:leantime.i18n.__("datatables.infoFiltered"),infoPostFix:leantime.i18n.__("datatables.infoPostFix"),thousands:leantime.i18n.__("datatables.thousands"),lengthMenu:leantime.i18n.__("datatables.lengthMenu"),loadingRecords:leantime.i18n.__("datatables.loadingRecords"),processing:leantime.i18n.__("datatables.processing"),search:leantime.i18n.__("datatables.search"),zeroRecords:leantime.i18n.__("datatables.zeroRecords"),paginate:{first:leantime.i18n.__("datatables.first"),last:leantime.i18n.__("datatables.last"),next:leantime.i18n.__("datatables.next"),previous:leantime.i18n.__("datatables.previous")},aria:{sortAscending:leantime.i18n.__("datatables.sortAscending"),sortDescending:leantime.i18n.__("datatables.sortDescending")}},dom:'<"top">rt<"bottom"ilp><"clear">',searching:!1,displayLength:100})})},initProjectsEditor:function(){jQuery("textarea.projectTinymce").tinymce({width:"98%",skin_url:leantime.appUrl+"/css/tinymceSkin/oxide",content_css:leantime.appUrl+"/css/tinymceSkin/oxide/content.css",height:"300",content_style:"img { max-width: 100%; }",plugins:"autolink,link,image,lists,pagebreak,table,save,insertdatetime,preview,media,searchreplace,print,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,template,advlist",toolbar:"bold italic strikethrough | fontsizeselect forecolor | link unlink image | bullist | fullscreen",branding:!1,statusbar:!1,convert_urls:!1,paste_data_images:!0,images_upload_handler:function(blobInfo,success,failure){var xhr,formData;(xhr=new XMLHttpRequest).withCredentials=!1,xhr.open("POST",leantime.appUrl+"/api/files"),xhr.onload=function(){xhr.status<200||300<=xhr.status?failure("HTTP Error: "+xhr.status):success(xhr.responseText)},(formData=new FormData).append("file",blobInfo.blob()),xhr.send(formData)},file_picker_callback:function(callback,value,meta){window.filePickerCallback=callback;var shortOptions={afterShowCont:function(){jQuery(".fileModal").nyroModal({callbacks:shortOptions})}};jQuery.nmManual("/files/showAll&modalPopUp=true",{stack:!0,callbacks:shortOptions,sizes:{minW:500,minH:500}}),jQuery.nmTop().elts.cont.css("zIndex","1000010"),jQuery.nmTop().elts.bg.css("zIndex","1000010"),jQuery.nmTop().elts.load.css("zIndex","1000010"),jQuery.nmTop().elts.all.find(".nyroModalCloseButton").css("zIndex","1000010")}})},initDuplicateProjectModal:function(){var regularModelConfig={sizes:{minW:450,minH:350},resizable:!0,autoSizable:!0,callbacks:{afterShowCont:function(){jQuery(".showDialogOnLoad").show(),initDates(),jQuery(".duplicateProjectModal, .formModal").nyroModal(regularModelConfig)},beforeClose:function(){location.reload()}}};jQuery(".duplicateProjectModal").nyroModal(regularModelConfig)}}}(),leantime.retroController=function(){var closeModal=!1,canvasoptions={sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){jQuery(".showDialogOnLoad").show(),1==closeModal&&(closeModal=!1,location.reload())},afterShowCont:function(){jQuery(".retroModal, #commentForm, #commentForm .deleteComment, .retroMilestone .deleteMilestone").nyroModal(canvasoptions)},beforeClose:function(){location.reload()}},titleFromIframe:!0};jQuery(document).ready(function(){});return{setCloseModal:function(){closeModal=!0},toggleMilestoneSelectors:function(trigger){"existing"==trigger&&(jQuery("#newMilestone, #milestoneSelectors").hide("fast"),jQuery("#existingMilestone").show(),_initModals()),"new"==trigger&&(jQuery("#newMilestone").show(),jQuery("#existingMilestone, #milestoneSelectors").hide("fast"),_initModals()),"hide"==trigger&&(jQuery("#newMilestone, #existingMilestone").hide("fast"),jQuery("#milestoneSelectors").show("fast"))},openModalManually:function(url){jQuery.nmManual(url,canvasoptions)},initModals:function(){jQuery(".retroModal, #commentForm, #commentForm .deleteComment, .retroMilestone .deleteMilestone").nyroModal(canvasoptions)},initBoardControlModal:function(){jQuery(".addItem").click(function(){jQuery("#box").val(jQuery(this).attr("id")),jQuery("#addItem").modal("show")}),jQuery(".addCanvasLink").click(function(){jQuery("#addCanvas").modal("show")}),jQuery(".editCanvasLink").click(function(){jQuery("#editCanvas").modal("show")})},initUserDropdown:function(){jQuery("body").on("click",".userDropdown .dropdown-menu a",function(){var dataValue=jQuery(this).attr("data-value").split("_");jQuery(this).attr("data-label");if(3==dataValue.length){var canvasId=dataValue[0],userId=dataValue[1],profileImageId=dataValue[2];jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/retrospectives",data:{id:canvasId,author:userId}}).done(function(){jQuery("#userDropdownMenuLink"+canvasId+" span.text span#userImage"+canvasId+" img").attr("src",leantime.appUrl+"/api/users?profileImage="+profileImageId),jQuery.jGrowl(leantime.i18n.__("short_notifications.user_updated"))})}})},setKanbanHeights:function(){var height=jQuery("html").height()-320;jQuery("#sortableRetroKanban .column .contentInner").css("height",height)}}}(),leantime.settingController=function(){var _uploadResult,clearCroppie=function(){jQuery("#logoImg").croppie("destroy"),jQuery("#previousImage").show()};return{readURL:function(input){if(clearCroppie(),input.files&&input.files[0]){var reader=new FileReader,profileImg=jQuery("#logoImg");reader.onload=function(e){(_uploadResult=profileImg.croppie({enableExif:!0,enforceBoundary:!1,viewport:{width:260,height:60,type:"square"},boundary:{width:400,height:200}})).croppie("bind",{url:e.currentTarget.result}),jQuery("#previousImage").hide()},reader.readAsDataURL(input.files[0])}},clearCroppie:clearCroppie,saveCroppie:function(){jQuery("#save-logo").addClass("running"),jQuery("#logoImg").attr("src",leantime.appUrl+"/images/loaders/loader28.gif"),_uploadResult.croppie("result",{type:"blob",circle:!1,size:"original",quality:1}).then(function(result){leantime.settingService.saveLogo(result)})}}}(),leantime.settingRepository={saveLogo:function(photo){var formData=new FormData;formData.append("file",photo),jQuery.ajax({type:"POST",url:leantime.appUrl+"/api/setting",data:formData,processData:!1,contentType:!1,success:function(resp){jQuery("#save-logo").removeClass("running"),location.reload()},error:function(err){console.log(err)}})}},leantime.settingService={saveLogo:function(photo){leantime.settingRepository.saveLogo(photo)}},leantime.ticketsController=function(){var milestoneModalConfig={sizes:{minW:500,minH:750},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){jQuery(".showDialogOnLoad").show()},afterShowCont:function(){jQuery(".showDialogOnLoad").show(),_initSprintDates(),_initSimpleColorPicker(),jQuery(".formModal, #commentForm, .deleteComment").nyroModal(milestoneModalConfig)},beforeClose:function(){location.reload()}},titleFromIframe:!0};jQuery(document).ready(function(){_initDueDateTimePickers(),_initDates(),_initModals()});function initToolTips(){jQuery('[data-toggle="tooltip"]').tooltip()}var _initDates=function(){jQuery(".dates").datepicker({dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:JSON.parse(leantime.i18n.__("language.isRTL")),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")})},_initSprintDates=function(){Date.prototype.addDays=function(days){return this.setDate(this.getDate()+days),this},jQuery.datepicker.setDefaults({beforeShow:function(i){if(jQuery(i).attr("readonly"))return!1}});var dateFormat=leantime.i18n.__("language.jsdateformat"),from=jQuery("#sprintStart").datepicker({numberOfMonths:1,dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:JSON.parse(leantime.i18n.__("language.isRTL")),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")}).on("change",function(){to.datepicker("option","minDate",getDate(this));var newEndDate=getDate(this).addDays(13);to.datepicker("setDate",newEndDate)}),to=jQuery("#sprintEnd").datepicker({defaultDate:"+1w",numberOfMonths:1,dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:JSON.parse(leantime.i18n.__("language.isRTL")),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")}).on("change",function(){from.datepicker("option","maxDate",getDate(this))});function getDate(element){var date;try{date=jQuery.datepicker.parseDate(dateFormat,element.value)}catch(error){date=null,console.log(error)}return date}},_initModals=function(){var regularModelConfig={callbacks:{afterShowCont:function(){jQuery(".showDialogOnLoad").show(),_initDates(),jQuery(".regularModal, .formModal").nyroModal(regularModelConfig)}}};jQuery(".regularModal").nyroModal(regularModelConfig);var sprintModalConfig={sizes:{minW:400,minH:350},resizable:!0,autoSizable:!0,callbacks:{afterShowCont:function(){_initSprintDates(),initToolTips(),jQuery(".formModal").nyroModal(sprintModalConfig)},beforeClose:function(){location.reload()}},titleFromIframe:!0};jQuery(".sprintModal").nyroModal(sprintModalConfig);var modalConfig={sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){jQuery(".showDialogOnLoad").show()},afterShowCont:function(){jQuery(".showDialogOnLoad").show(),function(){var dateFormat=leantime.i18n.__("language.jsdateformat"),from=jQuery("#milestoneEditFrom").datepicker({numberOfMonths:1,dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:JSON.parse(leantime.i18n.__("language.isRTL")),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")}).on("change",function(){to.datepicker("option","minDate",getDate(this))}),to=jQuery("#milestoneEditTo").datepicker({defaultDate:"+1w",numberOfMonths:1,dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:JSON.parse(leantime.i18n.__("language.isRTL")),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")}).on("change",function(){from.datepicker("option","maxDate",getDate(this))});function getDate(element){var date;try{date=jQuery.datepicker.parseDate(dateFormat,element.value)}catch(error){date=null,console.log(error)}return date}}(),_initSimpleColorPicker(),jQuery(".formModal, #commentForm, .deleteComment").nyroModal(modalConfig)},beforeClose:function(){location.reload()}},titleFromIframe:!0};jQuery(".milestoneModal").nyroModal(modalConfig)},_initSimpleColorPicker=function(){jQuery("input.simpleColorPicker").simpleColorPicker({colors:["#064779","#1B76BB","#00814A","#35CB8B","#F3B600","#FFD042","#BC3600","#F34500"],onChangeColor:function(color){jQuery(this).css("background",color)}});var currentColor=jQuery("input.simpleColorPicker").val();""!=currentColor&&jQuery("input.simpleColorPicker").css("background",currentColor)},_initDueDateTimePickers=function(){jQuery(".quickDueDates").datepicker({dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:JSON.parse(leantime.i18n.__("language.isRTL")),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader"),onClose:function(date){var newDate;""==date&&jQuery(this).val(leantime.i18n.__("text.anytime"));var dateTime=moment(date,leantime.i18n.__("language.momentJSDate")).format("YYYY-MM-DD HH:mm:ss"),id=jQuery(this).attr("data-id");newDate=dateTime,leantime.ticketsRepository.updateDueDates(id,newDate,function(){jQuery.jGrowl(leantime.i18n.__("short_notifications.duedate_updated"))})}})};return{toggleFilterBar:function(){jQuery(".filterBar").toggle()},triggerMilestoneModal:function(id){jQuery.nmManual(leantime.appUrl+"/tickets/editMilestone/"+id,milestoneModalConfig)},initGanttChart:function(tasks,viewMode){jQuery(document).ready(function(){var gantt_chart=new Gantt("#gantt",tasks,{custom_popup_html:function(task){var end_date=task._end.format(leantime.i18n.__("language.momentJSDate"));return'<div class="details-container"> <h4><a href="'+leantime.appUrl+"/tickets/editMilestone/"+task.id+'" class="milestoneModal">'+task.name+"</a></h4><br /> <p>"+leantime.i18n.__("text.expected_to_finish_by")+" <strong>"+end_date+"</strong><br /> "+Math.round(task.progress)+'%</p> <a href="'+leantime.appUrl+"/tickets/editMilestone/"+task.id+'" class="milestoneModal"><span class="fa fa-map"></span> '+leantime.i18n.__("links.edit_milestone")+'</a> | <a href="'+leantime.appUrl+"/tickets/showKanban&milestone="+task.id+'"><span class="iconfa-pushpin"></span> '+leantime.i18n.__("links.view_todos")+"</a> </div>"},on_click:function(task){},on_date_change:function(task,start,end){leantime.ticketsRepository.updateMilestoneDates(task.id,start,end),_initModals()},on_progress_change:function(task,progress){},on_view_change:function(mode){leantime.usersRepository.updateUserViewSettings("roadmap",mode),_initModals()}});jQuery("#ganttTimeControl").on("click","a",function(){var $btn=jQuery(this),mode=$btn.attr("data-value");gantt_chart.change_view_mode(mode),$btn.parent().parent().find("a").removeClass("active"),$btn.addClass("active");var label=$btn.text();jQuery(".viewText").text(label)}),gantt_chart.change_view_mode(viewMode)})},updateRemainingHours:function(element,id){var value=jQuery(element).val();leantime.ticketsRepository.updateRemainingHours(id,value,function(){jQuery.jGrowl(leantime.i18n.__("short_notifications.remaining_hours_updated"))})},updatePlannedHours:function(element,id){var value=jQuery(element).val();leantime.ticketsRepository.updatePlannedHours(id,value,function(){jQuery.jGrowl(leantime.i18n.__("short_notifications.planned_hours_updated"))})},initModals:function(){_initModals()},openMilestoneModalManually:function(url){jQuery.nmManual(url,milestoneModalConfig)},initTimeSheetChart:function(labels,d2,d3,canvasId){var ctx=document.getElementById(canvasId).getContext("2d");new Chart(ctx,{type:"line",data:{labels:labels,datasets:[{label:leantime.i18n.__("label.booked_hours"),backgroundColor:"rgba(201,48,44, 0.5)",borderColor:"rgb(201,48,44)",data:d2},{label:leantime.i18n.__("label.planned_hours"),backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgb(54, 162, 235)",data:d3}]},options:{scales:{yAxes:[{}]}}})},colorTicketBoxes:function(currentBox){var color="#fff";jQuery(".ticketBox").each(function(index){var value=jQuery(this).find(".statusDropdown > a").attr("class");null!=value&&(color=-1<value.indexOf("important")?"#b94a48":-1<value.indexOf("info")?"#2d6987":-1<value.indexOf("warning")?"#f89406":-1<value.indexOf("success")?"#468847":(value.indexOf("default"),"#999999"),jQuery(this).css("borderLeft","5px solid "+color),null!=currentBox&&jQuery(this).attr("data-val")==currentBox&&jQuery("#ticket_"+currentBox+" .ticketBox").animate({backgroundColor:color},"fast").animate({backgroundColor:"#fff"},"slow"))})},initTicketTabs:function(){jQuery(document).ready(function(){jQuery(".ticketTabs").tabs({create:function(event,ui){jQuery(".ticketTabs").css("visibility","visible")},activate:function(event,ui){window.location.hash=ui.newPanel.selector}})})},initTicketSearchSubmit:function(url){jQuery("#ticketSearch").on("submit",function(e){e.preventDefault();var project=jQuery("#projectIdInput").val(),users=jQuery("#userSelect").val(),milestones=jQuery("#milestoneSelect").val(),term=jQuery("#termInput").val(),sprints=jQuery("#sprintSelect").val(),types=jQuery("#typeSelect").val(),status=jQuery("#statusSelect").val(),sort=jQuery("#sortBySelect").val(),groupBy=jQuery("input[name='groupBy']:checked").val(),query="?search=true";""!=project&&null!=project&&(query=query+"&projectId="+project),""!=users&&null!=users&&(query=query+"&users="+users),""!=milestones&&null!=milestones&&(query=query+"&milestone="+milestones),""!=term&&null!=term&&(query=query+"&term="+term),""!=sprints&&null!=sprints&&(query=query+"&sprint="+sprints),""!=types&&null!=types&&(query=query+"&type="+types),""!=status&&null!=status&&(query=query+"&status="+status),""!=sort&&null!=sort&&(query=query+"&sort="+sort),""!=groupBy&&null!=groupBy&&(query=query+"&groupBy="+groupBy);var rediredirectUrl=url+query;window.location.href=rediredirectUrl})},initTicketKanban:function(ticketStatusList){function countTickets(){jQuery("#sortableTicketKanban .column").each(function(){var counting=jQuery(this).find(".moveable").length;jQuery(this).find(" .count").text(counting)})}jQuery(document).ready(function(){countTickets(),jQuery(".filterBar .row-fluid").css("opacity","1");var height=jQuery("html").height()-320;jQuery("#sortableTicketKanban .column .contentInner").css("height",height)}),jQuery("#sortableTicketKanban .ticketBox").hover(function(){jQuery(this).css("background","#f9f9f9")},function(){jQuery(this).css("background","#ffffff")}),jQuery("#sortableTicketKanban .contentInner").sortable({connectWith:".contentInner",items:"> .moveable",tolerance:"intersect",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,cancel:".portlet-toggle,:input,a,input",distance:25,start:function(event,ui){ui.item.addClass("tilt"),function(item){function move_handler(e){e.pageX>=left_pos?(item.addClass("right"),item.removeClass("left")):(item.addClass("left"),item.removeClass("right")),left_pos=e.pageX}var left_pos=item.position().left;jQuery("html").bind("mousemove",move_handler),item.data("move_handler",move_handler)}(ui.item)},stop:function(event,ui){ui.item.removeClass("tilt"),jQuery("html").unbind("mousemove",ui.item.data("move_handler")),ui.item.removeData("move_handler")},update:function(event,ui){countTickets();for(var statusPostData={action:"kanbanSort",payload:{}},i=0;i<ticketStatusList.length;i++)jQuery(".contentInner.status_"+ticketStatusList[i]).length&&(statusPostData.payload[ticketStatusList[i]]=jQuery(".contentInner.status_"+ticketStatusList[i]).sortable("serialize"));jQuery.ajax({type:"POST",url:leantime.appUrl+"/api/tickets",data:statusPostData})}}),jQuery(".portlet").addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all").find(".portlet-header").addClass("ui-widget-header ui-corner-all").prepend("<span class='ui-icon ui-icon-minusthick portlet-toggle'></span>"),jQuery(".portlet-toggle").click(function(){var icon=jQuery(this);icon.toggleClass("ui-icon-minusthick ui-icon-plusthick"),icon.closest(".portlet").find(".portlet-content").toggle()})},initUserSelectBox:function(){jQuery(".user-select").chosen()},initStatusSelectBox:function(){jQuery(".status-select").chosen()},initTicketsTable:function(groupBy){jQuery(document).ready(function(){var columnIndex=!1;""!=groupBy&&(columnIndex=jQuery("#allTicketsTable thead").find("."+groupBy+"-col").index());var plannedHoursIndex=jQuery("#allTicketsTable thead").find(".planned-hours-col").index(),remainingHoursIndex=jQuery("#allTicketsTable thead").find(".remaining-hours-col").index(),loggedHoursIndex=jQuery("#allTicketsTable thead").find(".booked-hours-col").index(),dueDateCol=jQuery("#allTicketsTable thead").find(".duedate-col").index(),rowGroupOption=!1,orderFixedOption=!1,defaultOrder=[];!1!==columnIndex&&(rowGroupOption={startRender:function(rows,group){var sumPlanned=rows.data().pluck(plannedHoursIndex).reduce(function(a,b){return parseInt(a)+parseInt(b["@data-order"])},"0"),sumRemaining=rows.data().pluck(remainingHoursIndex).reduce(function(a,b){return parseInt(a)+parseInt(b["@data-order"])},"0"),sumLogged=rows.data().pluck(loggedHoursIndex).reduce(function(a,b){return parseInt(a)+parseInt(b["@data-order"])},"0"),visiblePlannedHoursIndex=jQuery("#allTicketsTable thead").find(".planned-hours-col").index(),visibleRemainingHoursIndex=jQuery("#allTicketsTable thead").find(".remaining-hours-col").index(),visibleLoggedHoursIndex=jQuery("#allTicketsTable thead").find(".booked-hours-col").index(),totalColumns=jQuery("#allTicketsTable thead th").length;-1<visiblePlannedHoursIndex&&totalColumns--,-1<visibleRemainingHoursIndex&&totalColumns--,-1<visibleLoggedHoursIndex&&totalColumns--;var groupOutput=jQuery("<tr/>").append('<td colspan="'+totalColumns+'">'+group+" ("+rows.count()+")</td>");return-1<visiblePlannedHoursIndex&&groupOutput.append("<td>"+sumPlanned+"</td>"),-1<visibleRemainingHoursIndex&&groupOutput.append("<td>"+sumRemaining+"</td>"),-1<visibleLoggedHoursIndex&&groupOutput.append("<td>"+sumLogged+"</td>"),groupOutput},dataSrc:function(row){return row[columnIndex]["@data-order"]}},orderFixedOption={pre:[[columnIndex,"asc"]]},defaultOrder=[[columnIndex,"asc"],[dueDateCol,"asc"]]);var allTickets=jQuery("#allTicketsTable").DataTable({language:{decimal:leantime.i18n.__("datatables.decimal"),emptyTable:leantime.i18n.__("datatables.emptyTable"),info:leantime.i18n.__("datatables.info"),infoEmpty:leantime.i18n.__("datatables.infoEmpty"),infoFiltered:leantime.i18n.__("datatables.infoFiltered"),infoPostFix:leantime.i18n.__("datatables.infoPostFix"),thousands:leantime.i18n.__("datatables.thousands"),lengthMenu:leantime.i18n.__("datatables.lengthMenu"),loadingRecords:leantime.i18n.__("datatables.loadingRecords"),processing:leantime.i18n.__("datatables.processing"),search:leantime.i18n.__("datatables.search"),zeroRecords:leantime.i18n.__("datatables.zeroRecords"),paginate:{first:leantime.i18n.__("datatables.first"),last:leantime.i18n.__("datatables.last"),next:leantime.i18n.__("datatables.next"),previous:leantime.i18n.__("datatables.previous")},aria:{sortAscending:leantime.i18n.__("datatables.sortAscending"),sortDescending:leantime.i18n.__("datatables.sortDescending")},buttons:{colvis:leantime.i18n.__("datatables.buttons.colvis"),csv:leantime.i18n.__("datatables.buttons.download")}},dom:'<"top">rt<"bottom"ilp><"clear">',searching:!1,stateSave:!0,displayLength:100,orderFixed:orderFixedOption,order:defaultOrder,rowGroup:rowGroupOption});new jQuery.fn.dataTable.Buttons(allTickets,{buttons:[{extend:"csvHtml5",title:leantime.i18n.__("label.filename_fileexport"),exportOptions:{format:{body:function(data,row,column,node){return void 0!==jQuery(node).data("order")&&(data=jQuery(node).data("order")),data}}}},{extend:"colvis",columns:":not(.noVis)"}]}).container().appendTo(jQuery("#tableButtons"));jQuery("#allTicketsTable").on("column-visibility.dt",function(e,settings,column,state){allTickets.draw(!1)}),jQuery("#allTicketsTable input").on("change",function(e,settings,column,state){jQuery(this).parent().attr("data-order",jQuery(this).val()),allTickets.draw()});var asc=!0;""!=groupBy&&jQuery("#allTicketsTable thead").find("."+groupBy+"-col").on("click",function(e,settings,column,state){var orderFixed={pre:[[columnIndex,!0===(asc=!asc)?"asc":"desc"]]};allTickets.order.fixed(orderFixed).draw()})})},initEffortDropdown:function(){var storyPointLabels={1:"XS",2:"S",3:"M",5:"L",8:"XL",13:"XXL"};jQuery("body").on("click",".effortDropdown .dropdown-menu a",function(){var dataValue=jQuery(this).attr("data-value").split("_");if(2===dataValue.length){var ticketId=dataValue[0],effortId=dataValue[1];jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:ticketId,storypoints:effortId}}).done(function(){jQuery("#effortDropdownMenuLink"+ticketId+" span.text").text(storyPointLabels[effortId]),jQuery.jGrowl(leantime.i18n.__("short_notifications.effort_updated"))})}else console.log("Ticket Controller: Effort data value not set correctly")})},initMilestoneDropdown:function(){jQuery("body").on("click",".milestoneDropdown .dropdown-menu a",function(){var dataValue=jQuery(this).attr("data-value").split("_"),dataLabel=jQuery(this).attr("data-label");if(3===dataValue.length){var ticketId=dataValue[0],milestoneId=dataValue[1],color=dataValue[2];jQuery("#milestoneDropdownMenuLink"+ticketId+" span.text").append(" ..."),jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:ticketId,dependingTicketId:milestoneId}}).done(function(){jQuery("#milestoneDropdownMenuLink"+ticketId+" span.text").text(dataLabel),jQuery("#milestoneDropdownMenuLink"+ticketId).css("backgroundColor",color),jQuery.jGrowl(leantime.i18n.__("short_notifications.milestone_updated"))})}})},initStatusDropdown:function(){jQuery("body").on("click",".statusDropdown .dropdown-menu a",function(){var dataValue=jQuery(this).attr("data-value").split("_"),dataLabel=jQuery(this).attr("data-label");if(3==dataValue.length){var ticketId=dataValue[0],statusId=dataValue[1],className=dataValue[2];jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:ticketId,status:statusId}}).done(function(){jQuery("#statusDropdownMenuLink"+ticketId+" span.text").text(dataLabel),jQuery("#statusDropdownMenuLink"+ticketId).removeClass().addClass(className+" dropdown-toggle f-left status "),jQuery.jGrowl(leantime.i18n.__("short_notifications.status_updated")),leantime.ticketsController.colorTicketBoxes(ticketId)})}}),leantime.ticketsController.colorTicketBoxes()},initUserDropdown:function(){jQuery("body").on("click",".userDropdown .dropdown-menu a",function(){var dataValue=jQuery(this).attr("data-value").split("_"),dataLabel=jQuery(this).attr("data-label");if(3==dataValue.length){var ticketId=dataValue[0],userId=dataValue[1],profileImageId=dataValue[2];jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:ticketId,editorId:userId}}).done(function(){jQuery("#userDropdownMenuLink"+ticketId+" span.text span#userImage"+ticketId+" img").attr("src",leantime.appUrl+"/api/users?profileImage="+profileImageId),jQuery("#userDropdownMenuLink"+ticketId+" span.text span#user"+ticketId).text(dataLabel),jQuery.jGrowl(leantime.i18n.__("short_notifications.user_updated"))})}})},initSprintDropdown:function(){jQuery("body").on("click",".sprintDropdown .dropdown-menu a",function(){var dataValue=jQuery(this).attr("data-value").split("_"),dataLabel=jQuery(this).attr("data-label");if(2==dataValue.length){var ticketId=dataValue[0],sprintId=dataValue[1];jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:ticketId,sprint:sprintId}}).done(function(){jQuery("#sprintDropdownMenuLink"+ticketId+" span.text").text(dataLabel),jQuery.jGrowl(leantime.i18n.__("short_notifications.sprint_updated"))})}}),leantime.ticketsController.colorTicketBoxes()},initTicketEditor:function(){jQuery("textarea.tinymce").tinymce({width:"98%",skin_url:leantime.appUrl+"/css/tinymceSkin/oxide",content_css:leantime.appUrl+"/css/tinymceSkin/oxide/content.css",height:"300",content_style:"img { max-width: 100%; }",plugins:"autolink,link,image,lists,pagebreak,table,save,insertdatetime,preview,media,searchreplace,print,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,template,advlist",toolbar:"bold italic strikethrough | fontsizeselect forecolor | link unlink image | bullist | fullscreen",branding:!1,statusbar:!1,convert_urls:!1,paste_data_images:!0,images_upload_handler:function(blobInfo,success,failure){var xhr,formData;(xhr=new XMLHttpRequest).withCredentials=!1,xhr.open("POST",leantime.appUrl+"/api/files"),xhr.onload=function(){xhr.status<200||300<=xhr.status?failure("HTTP Error: "+xhr.status):success(xhr.responseText)},(formData=new FormData).append("file",blobInfo.blob()),xhr.send(formData)},file_picker_callback:function(callback,value,meta){window.filePickerCallback=callback;var shortOptions={afterShowCont:function(){jQuery(".fileModal").nyroModal({callbacks:shortOptions})}};jQuery.nmManual(leantime.appUrl+"/files/showAll&modalPopUp=true",{stack:!0,callbacks:shortOptions,sizes:{minW:500,minH:500}}),jQuery.nmTop().elts.cont.css("zIndex","1000010"),jQuery.nmTop().elts.bg.css("zIndex","1000010"),jQuery.nmTop().elts.load.css("zIndex","1000010"),jQuery.nmTop().elts.all.find(".nyroModalCloseButton").css("zIndex","1000010")}})},initToolTips:initToolTips,initTagsInput:function(){jQuery("#tags").tagsInput()},initMilestoneDatesAsyncUpdate:function(){var dateFormat=leantime.i18n.__("language.jsdateformat");jQuery(".milestoneEditFromAsync").datepicker({numberOfMonths:1,dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:JSON.parse(leantime.i18n.__("language.isRTL")),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")}).on("change",function(){var date=jQuery(this).val(),id=jQuery(this).attr("data-id");jQuery(".toDateTicket-"+id).datepicker("option","minDate",getDate(this));var newDate=moment(date,leantime.i18n.__("language.momentJSDate")).format("YYYY-MM-DD HH:mm:ss");leantime.ticketsRepository.updateEditFromDates(id,newDate,function(){jQuery.jGrowl(leantime.i18n.__("short_notifications.date_updated"))});var dateTo=jQuery(".toDateTicket-"+id).val(),newDateTo=moment(dateTo,leantime.i18n.__("language.momentJSDate")).format("YYYY-MM-DD HH:mm:ss");leantime.ticketsRepository.updateEditToDates(id,newDateTo,function(){})}),jQuery(".milestoneEditToAsync").datepicker({defaultDate:"+1w",numberOfMonths:1,dateFormat:leantime.i18n.__("language.jsdateformat"),dayNames:leantime.i18n.__("language.dayNames").split(","),dayNamesMin:leantime.i18n.__("language.dayNamesMin").split(","),dayNamesShort:leantime.i18n.__("language.dayNamesShort").split(","),monthNames:leantime.i18n.__("language.monthNames").split(","),currentText:leantime.i18n.__("language.currentText"),closeText:leantime.i18n.__("language.closeText"),buttonText:leantime.i18n.__("language.buttonText"),isRTL:JSON.parse(leantime.i18n.__("language.isRTL")),nextText:leantime.i18n.__("language.nextText"),prevText:leantime.i18n.__("language.prevText"),weekHeader:leantime.i18n.__("language.weekHeader")}).on("change",function(){var id=jQuery(this).attr("data-id");jQuery(".fromDateTicket-"+id).datepicker("option","maxDate",getDate(this));var date=jQuery(this).val(),newDate=moment(date,leantime.i18n.__("language.momentJSDate")).format("YYYY-MM-DD HH:mm:ss");leantime.ticketsRepository.updateEditToDates(id,newDate,function(){jQuery.jGrowl(leantime.i18n.__("short_notifications.date_updated"))});var dateFrom=jQuery(".fromDateTicket-"+id).val(),newDateFrom=moment(dateFrom,leantime.i18n.__("language.momentJSDate")).format("YYYY-MM-DD HH:mm:ss");leantime.ticketsRepository.updateEditFromDates(id,newDateFrom,function(){})});function getDate(element){var date;try{date=jQuery.datepicker.parseDate(dateFormat,element.value)}catch(error){date=null,console.log(error)}return date}}}}(),(leantime=leantime||{}).ticketsRepository={updateMilestoneDates:function(id,start,end){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:id,editFrom:start.format("YYYY-MM-DD"),editTo:end.format("YYYY-MM-DD")}}).done(function(){})},updateRemainingHours:function(id,remaining,callbackSuccess){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:id,hourRemaining:remaining}}).done(function(){callbackSuccess()})},updatePlannedHours:function(id,planhours,callbackSuccess){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:id,planHours:planhours}}).done(function(){callbackSuccess()})},updateDueDates:function(id,date,callbackSuccess){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:id,dateToFinish:date}}).done(function(){callbackSuccess()})},updateEditFromDates:function(id,date,callbackSuccess){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:id,editFrom:date}}).done(function(){callbackSuccess()})},updateEditToDates:function(id,date,callbackSuccess){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/tickets",data:{id:id,editTo:date}}).done(function(){callbackSuccess()})}},leantime.timesheetsController=function(){var closeModal=!1;jQuery(document).ready(function(){_initTicketTimers()});var _initTicketTimers=function(){jQuery(".punchIn").on("click",function(){var ticketId=jQuery(this).attr("data-value");jQuery.ajax({data:{ticketId:ticketId,action:"start"},type:"POST",url:leantime.appUrl+"/api/timer"}).done(function(msg){jQuery.jGrowl(leantime.i18n.__("short_notifications.timer_started"))});var currentdate=moment().format(leantime.i18n.__("language.jstimeformat"));jQuery(".timerContainer .punchIn").hide(),jQuery("#timerContainer-"+ticketId+" .punchOut").show(),jQuery(".timerContainer .working").show(),jQuery("#timerContainer-"+ticketId+" .working").hide(),jQuery("#timerContainer-"+ticketId+" span.time").text(currentdate)}),jQuery(".punchOut").on("click",function(){var ticketId=jQuery(this).attr("data-value");jQuery.ajax({data:{ticketId:ticketId,action:"stop"},type:"POST",url:leantime.appUrl+"/api/timer"}).done(function(hoursLogged){0==hoursLogged?jQuery.jGrowl(leantime.i18n.__("short_notifications.not_enough_time_logged")):jQuery.jGrowl(leantime.i18n.__("short_notifications.logged_x_hours").replace("%1$s",hoursLogged))}),jQuery(".timerContainer .punchIn").show(),jQuery(".timerContainer .punchOut").hide(),jQuery(".timerContainer .working").hide(),jQuery(".timerHeadMenu").hide("slow")})};return{initTimesheetsTable:function(groupBy){jQuery(document).ready(function(){var allTimesheets=jQuery("#allTimesheetsTable").DataTable({language:{decimal:leantime.i18n.__("datatables.decimal"),emptyTable:leantime.i18n.__("datatables.emptyTable"),info:leantime.i18n.__("datatables.info"),infoEmpty:leantime.i18n.__("datatables.infoEmpty"),infoFiltered:leantime.i18n.__("datatables.infoFiltered"),infoPostFix:leantime.i18n.__("datatables.infoPostFix"),thousands:leantime.i18n.__("datatables.thousands"),lengthMenu:leantime.i18n.__("datatables.lengthMenu"),loadingRecords:leantime.i18n.__("datatables.loadingRecords"),processing:leantime.i18n.__("datatables.processing"),search:leantime.i18n.__("datatables.search"),zeroRecords:leantime.i18n.__("datatables.zeroRecords"),paginate:{first:leantime.i18n.__("datatables.first"),last:leantime.i18n.__("datatables.last"),next:leantime.i18n.__("datatables.next"),previous:leantime.i18n.__("datatables.previous")},aria:{sortAscending:leantime.i18n.__("datatables.sortAscending"),sortDescending:leantime.i18n.__("datatables.sortDescending")},buttons:{colvis:leantime.i18n.__("datatables.buttons.colvis"),csv:leantime.i18n.__("datatables.buttons.download")}},dom:'<"top">rt<"bottom"ilp><"clear">',searching:!1,stateSave:!0,displayLength:100});new jQuery.fn.dataTable.Buttons(allTimesheets,{buttons:[{extend:"csvHtml5",title:leantime.i18n.__("label.filename_fileexport"),exportOptions:{format:{body:function(data,row,column,node){return void 0!==jQuery(node).data("order")&&(data=jQuery(node).data("order")),data}}}},{extend:"colvis",columns:":not(.noVis)"}]}).container().appendTo(jQuery("#tableButtons"));jQuery("#allTimesheetsTable").on("column-visibility.dt",function(e,settings,column,state){allTimesheets.draw(!1)})})},initEditTimeModal:function(){var canvasoptions={sizes:{minW:700,minH:1e3},resizable:!0,autoSizable:!0,callbacks:{beforeShowCont:function(){jQuery(".showDialogOnLoad").show(),1==closeModal&&(closeModal=!1,location.reload())},afterShowCont:function(){jQuery(".editTimeModal").nyroModal(canvasoptions)},beforeClose:function(){location.reload()}},titleFromIframe:!0};jQuery(".editTimeModal").nyroModal(canvasoptions)}}}(),leantime.usersController=function(){var _uploadResult,clearCroppie=function(){jQuery("#profileImg").croppie("destroy"),jQuery("#previousImage").show()};return{readURL:function(input){if(clearCroppie(),input.files&&input.files[0]){var reader=new FileReader,profileImg=jQuery("#profileImg");reader.onload=function(e){(_uploadResult=profileImg.croppie({enableExif:!0,viewport:{width:175,height:175,type:"circle"},boundary:{width:200,height:200}})).croppie("bind",{url:e.currentTarget.result}),jQuery("#previousImage").hide()},reader.readAsDataURL(input.files[0])}},clearCroppie:clearCroppie,saveCroppie:function(){jQuery("#save-picture").addClass("running"),jQuery("#profileImg").attr("src",leantime.appUrl+"/images/loaders/loader28.gif"),_uploadResult.croppie("result",{type:"blob",circle:!0}).then(function(result){leantime.usersService.saveUserPhoto(result)})},initUserTable:function(){jQuery(document).ready(function(){jQuery("#allUsersTable").DataTable({language:{decimal:leantime.i18n.__("datatables.decimal"),emptyTable:leantime.i18n.__("datatables.emptyTable"),info:leantime.i18n.__("datatables.info"),infoEmpty:leantime.i18n.__("datatables.infoEmpty"),infoFiltered:leantime.i18n.__("datatables.infoFiltered"),infoPostFix:leantime.i18n.__("datatables.infoPostFix"),thousands:leantime.i18n.__("datatables.thousands"),lengthMenu:leantime.i18n.__("datatables.lengthMenu"),loadingRecords:leantime.i18n.__("datatables.loadingRecords"),processing:leantime.i18n.__("datatables.processing"),search:leantime.i18n.__("datatables.search"),zeroRecords:leantime.i18n.__("datatables.zeroRecords"),paginate:{first:leantime.i18n.__("datatables.first"),last:leantime.i18n.__("datatables.last"),next:leantime.i18n.__("datatables.next"),previous:leantime.i18n.__("datatables.previous")},aria:{sortAscending:leantime.i18n.__("datatables.sortAscending"),sortDescending:leantime.i18n.__("datatables.sortDescending")}},dom:'<"top">rt<"bottom"ilp><"clear">',searching:!1,displayLength:100})})}}}(),leantime.usersRepository={saveUserPhoto:function(photo){var formData=new FormData;formData.append("file",photo),jQuery.ajax({type:"POST",url:leantime.appUrl+"/api/users",data:formData,processData:!1,contentType:!1,success:function(resp){jQuery("#save-picture").removeClass("running"),location.reload()},error:function(err){console.log(err)}})},updateUserViewSettings:function(module,value){jQuery.ajax({type:"PATCH",url:leantime.appUrl+"/api/users",data:{patchViewSettings:module,value:value}}).done(function(){})}},leantime.usersService={saveUserPhoto:function(photo){leantime.usersRepository.saveUserPhoto(photo)}};
//# sourceMappingURL=jsSourceMapAppSrc.map